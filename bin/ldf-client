#!/usr/bin/env node
/*! @license ©2013 Ruben Verborgh - Multimedia Lab / iMinds / Ghent University */

var fs = require('fs'),
    LinkedDataFragmentsClient = require('../lib/LinkedDataFragmentsClient'),
    client = new LinkedDataFragmentsClient('http://data.linkeddatafragments.org/dbpedia');

var queryMatcher = /^\s*(?:prefix|select|construct|ask|describe)\s+/i;

// Parse arguments
var args = process.argv.slice(2);
if (args.length !== 1) {
  console.log('usage: ldf-client query');
  return process.exit(1);
}
var queryFile = args[0],
    isQuery = queryMatcher.test(queryFile),
    query = isQuery ? queryFile : fs.readFileSync(queryFile, { encoding: 'utf8' });

// Execute query
client.getQueryResults(query)
      .then(function (results) { console.log('\n\n\nRESULTS\n', JSON.stringify(results, null, '  ')); },
            function (error)   { console.log(error.stack) });
