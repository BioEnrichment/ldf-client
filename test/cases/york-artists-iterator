#!/usr/bin/env node
/*! @license Â©2014 Ruben Verborgh - Multimedia Lab / iMinds / Ghent University */

var fragmentUrl = 'http://data.linkeddatafragments.org/dbpedia{?subject,predicate,object}';

var FragmentsClient = require('../../lib/http/FragmentsClient'),
    UriTemplate = require('uritemplate'),
    SingleItemIterator = require('../../lib/iterators/SingleItemIterator'),
    GraphPatternIterator = require('../../lib/iterators/GraphPatternIterator'),
    rdf = require('../../lib/rdf/RdfUtil');

var client = new FragmentsClient(UriTemplate.parse(fragmentUrl)),
    iteratorOptions = { fragmentsClient: client };

var p_type_artist = rdf.triple('?p', rdf.RDF_TYPE, rdf.DBPEDIAOWL + 'Artist'),
    p_birthPlace_c = rdf.triple('?p', rdf.DBPEDIAOWL + 'birthPlace', '?c'),
    c_name_York = rdf.triple('?c', rdf.FOAF + 'name', '"York"@en');
var query = [p_type_artist, p_birthPlace_c, c_name_York];

var bindingsStream =
  new SingleItemIterator({ })
  .pipe(new GraphPatternIterator(query, iteratorOptions));

bindingsStream.on('data', function (bindingsContext) {
  console.log(JSON.stringify(bindingsContext.bindings));
});
bindingsStream.on('error', console.error);
