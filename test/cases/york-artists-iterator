#!/usr/bin/env node
/*! @license Â©2014 Ruben Verborgh - Multimedia Lab / iMinds / Ghent University */

var fragmentUrl = 'http://data.linkeddatafragments.org/dbpedia{?subject,predicate,object}';

var FragmentsClient = require('../../lib/http/FragmentsClient'),
    UriTemplate = require('uritemplate'),
    Iterator = require('../../lib/iterators/Iterator'),
    TriplePatternIterator = require('../../lib/iterators/TriplePatternIterator'),
    rdf = require('../../lib/rdf/RdfUtil');

var client = new FragmentsClient(UriTemplate.parse(fragmentUrl)),
    iteratorOptions = { fragmentsClient: client, bufferSize: 8 };

var p_type_artist = rdf.triple('?p', rdf.RDF_TYPE, rdf.DBPEDIAOWL + 'Artist'),
    p_birthPlace_c = rdf.triple('?p', rdf.DBPEDIAOWL + 'birthPlace', '?c'),
    c_name_York = rdf.triple('?c', rdf.FOAF + 'name', '"York"@en');
var query = [p_type_artist, p_birthPlace_c, c_name_York];

var iterator = Iterator.single({ bindings: { } });
iterator = new TriplePatternIterator(iterator, c_name_York, iteratorOptions);
iterator = new TriplePatternIterator(iterator, p_birthPlace_c, iteratorOptions);
iterator = new TriplePatternIterator(iterator, p_type_artist, iteratorOptions);

iterator.on('data', function (bindingsContext) {
  console.log(JSON.stringify(bindingsContext.bindings));
});
iterator.on('error', console.error);
